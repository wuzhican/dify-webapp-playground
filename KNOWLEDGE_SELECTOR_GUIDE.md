# å¯¹è¯çŸ¥è¯†åº“é€‰æ‹©ç»„ä»¶ä½¿ç”¨æŒ‡å—

## æ¦‚è¿°

æœ¬æ–‡æ¡£ä»‹ç»äº†æ–°å¢çš„å¯¹è¯çŸ¥è¯†åº“é€‰æ‹©åŠŸèƒ½ï¼Œè¯¥åŠŸèƒ½å…è®¸ç”¨æˆ·åœ¨èŠå¤©è¾“å…¥æ¡†ä¸­é€šè¿‡ `@` ç¬¦å·è§¦å‘ä¸‹æ‹‰é€‰æ‹©å™¨æ¥é€‰æ‹©çŸ¥è¯†åº“ï¼Œå¹¶åœ¨å‘é€æ¶ˆæ¯æ—¶å°†é€‰æ‹©çš„çŸ¥è¯†åº“ä¿¡æ¯ä¼ é€’ç»™åç«¯ã€‚

## åŠŸèƒ½ç‰¹æ€§

### æ ¸å¿ƒåŠŸèƒ½
- âœ… **@ç¬¦å·è§¦å‘**: åœ¨è¾“å…¥æ¡†ä¸­è¾“å…¥ `@` ç¬¦å·è‡ªåŠ¨æ˜¾ç¤ºçŸ¥è¯†åº“é€‰æ‹©å™¨
- âœ… **æœç´¢è¿‡æ»¤**: æ”¯æŒæŒ‰åç§°å’Œæè¿°æœç´¢çŸ¥è¯†åº“
- âœ… **å·²é€‰æ‹©å±•ç¤º**: ç±»ä¼¼å›¾ç‰‡åˆ—è¡¨çš„å±•ç¤ºæ–¹å¼ï¼Œåœ¨è¾“å…¥æ¡†ä¸Šæ–¹æ˜¾ç¤ºå·²é€‰æ‹©çš„çŸ¥è¯†åº“
- âœ… **é˜²é‡å¤é€‰æ‹©**: è‡ªåŠ¨è¿‡æ»¤å·²é€‰æ‹©çš„çŸ¥è¯†åº“
- âœ… **é”®ç›˜å¯¼èˆª**: æ”¯æŒ â†‘â†“ é”®å¯¼èˆªï¼ŒEnter é€‰æ‹©ï¼ŒEsc å…³é—­
- âœ… **å¤šè¯­è¨€æ”¯æŒ**: æ”¯æŒä¸­æ–‡ã€è‹±æ–‡ã€è¥¿ç­ç‰™è¯­ã€æ—¥è¯­ã€è¶Šå—è¯­
- âœ… **å“åº”å¼è®¾è®¡**: é€‚é…æ¡Œé¢ç«¯å’Œç§»åŠ¨ç«¯

### äº¤äº’ç‰¹æ€§
- **Backspaceåˆ é™¤**: è¾“å…¥æ¡†ä¸ºç©ºæ—¶æŒ‰ Backspace å¯åˆ é™¤æœ€åé€‰æ‹©çš„çŸ¥è¯†åº“
- **è‡ªåŠ¨å…³é—­**: é€‰æ‹©çŸ¥è¯†åº“åè‡ªåŠ¨å…³é—­é€‰æ‹©å™¨
- **ç‚¹å‡»å¤–éƒ¨å…³é—­**: ç‚¹å‡»é€‰æ‹©å™¨å¤–éƒ¨åŒºåŸŸè‡ªåŠ¨å…³é—­
- **å‘é€åæ¸…ç†**: å‘é€æ¶ˆæ¯åè‡ªåŠ¨æ¸…ç©ºå·²é€‰æ‹©çš„çŸ¥è¯†åº“

## ç»„ä»¶æ¶æ„

### æ–°å¢ç»„ä»¶

#### 1. KnowledgeList ç»„ä»¶
ä½ç½®: `app/components/base/knowledge-list/index.tsx`

å±•ç¤ºå·²é€‰æ‹©çŸ¥è¯†åº“çš„æ°´å¹³åˆ—è¡¨ç»„ä»¶ï¼Œæ”¯æŒï¼š
- æ˜¾ç¤ºçŸ¥è¯†åº“åç§°ã€é¢œè‰²æ ‡è¯†å’Œå›¾æ ‡
- åˆ é™¤æ“ä½œï¼ˆé readonly æ¨¡å¼ï¼‰
- æœ€å¤§æ˜¾ç¤ºæ•°é‡é™åˆ¶
- è¶…å‡ºæ—¶æ˜¾ç¤º"æ›´å¤š"æç¤º

#### 2. KnowledgeSelector ç»„ä»¶
ä½ç½®: `app/components/base/knowledge-selector/index.tsx`

çŸ¥è¯†åº“ä¸‹æ‹‰é€‰æ‹©å™¨ç»„ä»¶ï¼Œæ”¯æŒï¼š
- æœç´¢è¿‡æ»¤åŠŸèƒ½
- é”®ç›˜å¯¼èˆª
- é˜²é‡å¤é€‰æ‹©
- çŸ¥è¯†åº“ç±»å‹æ ‡è¯†

#### 3. ç±»å‹å®šä¹‰
ä½ç½®: `types/app.ts`

```typescript
export type KnowledgeItem = {
  id: string
  name: string
  description?: string
  color?: string // çŸ¥è¯†åº“æ ‡è¯†é¢œè‰²
  icon?: string // å›¾æ ‡ç±»å‹
  type?: 'document' | 'qa' | 'manual' // çŸ¥è¯†åº“ç±»å‹
  status?: 'active' | 'inactive' // çŠ¶æ€
}
```

## ä½¿ç”¨æ–¹æ³•

### 1. åŸºæœ¬ä½¿ç”¨

```typescript
import Chat from '@/app/components/chat'
import type { KnowledgeItem, VisionFile } from '@/types/app'

// å®šä¹‰çŸ¥è¯†åº“åˆ—è¡¨
const knowledgeList: KnowledgeItem[] = [
  {
    id: 'kb_001',
    name: 'äº§å“æ‰‹å†Œ',
    description: 'äº§å“åŠŸèƒ½å’Œä½¿ç”¨æŒ‡å—',
    color: '#3b82f6',
    icon: 'ğŸ“š',
    type: 'manual',
    status: 'active'
  },
  // ... æ›´å¤šçŸ¥è¯†åº“
]

// å¤„ç†æ¶ˆæ¯å‘é€
const handleSendMessage = (
  message: string, 
  files: VisionFile[], 
  knowledgeList?: KnowledgeItem[]
) => {
  // æ„å»ºè¯·æ±‚å‚æ•°
  const inputs = {
    // å…¶ä»–ç°æœ‰ inputs...
    selected_knowledge_ids: knowledgeList?.map(k => k.id) || []
  }
  
  // è°ƒç”¨ API
  chatAPI.sendMessage({
    query: message,
    files,
    inputs
  })
}

// ä½¿ç”¨ Chat ç»„ä»¶
<Chat
  chatList={chatList}
  onSend={handleSendMessage}
  knowledgeConfig={{
    enabled: true,
    knowledgeList: knowledgeList
  }}
  // ... å…¶ä»–é…ç½®
/>
```

### 2. é…ç½®é€‰é¡¹

#### knowledgeConfig é…ç½®
```typescript
knowledgeConfig?: {
  enabled: boolean              // æ˜¯å¦å¯ç”¨çŸ¥è¯†åº“é€‰æ‹©åŠŸèƒ½
  knowledgeList: KnowledgeItem[] // å¯é€‰æ‹©çš„çŸ¥è¯†åº“åˆ—è¡¨
}
```

### 3. å›è°ƒå‡½æ•°ç­¾åæ›´æ–°

`onSend` å›è°ƒå‡½æ•°å¢åŠ äº†ç¬¬ä¸‰ä¸ªå‚æ•°ï¼š

```typescript
onSend?: (
  message: string,           // æ¶ˆæ¯å†…å®¹
  files: VisionFile[],       // æ–‡ä»¶åˆ—è¡¨
  knowledgeList?: KnowledgeItem[] // é€‰æ‹©çš„çŸ¥è¯†åº“åˆ—è¡¨ï¼ˆæ–°å¢ï¼‰
) => void
```

## å›½é™…åŒ–é…ç½®

### è¯­è¨€é”®å€¼å¯¹ç…§è¡¨

| é”®å | ä¸­æ–‡ | è‹±æ–‡ | è¯´æ˜ |
|------|------|------|------|
| `app.knowledgeSelector.placeholder` | é€‰æ‹©çŸ¥è¯†åº“... | Select knowledge base... | é€‰æ‹©å™¨å ä½ç¬¦ |
| `app.knowledgeSelector.searchPlaceholder` | æœç´¢çŸ¥è¯†åº“ | Search knowledge bases | æœç´¢æ¡†å ä½ç¬¦ |
| `app.knowledgeSelector.noResults` | æœªæ‰¾åˆ°åŒ¹é…çš„çŸ¥è¯†åº“ | No matching knowledge bases found | æœç´¢æ— ç»“æœ |
| `app.knowledgeSelector.noAvailable` | æš‚æ— å¯ç”¨çŸ¥è¯†åº“ | No available knowledge bases | æ— å¯ç”¨çŸ¥è¯†åº“ |
| `app.knowledgeSelector.inputPlaceholder` | åœ¨è¿™é‡Œè¾“å…¥æ¶ˆæ¯... (è¾“å…¥ @ é€‰æ‹©çŸ¥è¯†åº“) | Type your message here... (Type @ to select knowledge base) | è¾“å…¥æ¡†æç¤º |
| `app.knowledgeSelector.navigationTip` | ä½¿ç”¨ â†‘â†“ å¯¼èˆªï¼ŒEnter é€‰æ‹©ï¼ŒEsc å…³é—­ | Use â†‘â†“ to navigate, Enter to select, Esc to close | å¯¼èˆªæç¤º |

### æ·»åŠ æ–°è¯­è¨€æ”¯æŒ

1. åœ¨ `i18n/lang/app.[lang].ts` ä¸­æ·»åŠ  `knowledgeSelector` é…ç½®
2. å‚è€ƒç°æœ‰è¯­è¨€æ–‡ä»¶çš„ç»“æ„æ·»åŠ å¯¹åº”ç¿»è¯‘

## API é›†æˆ

### è¯·æ±‚æ ¼å¼
çŸ¥è¯†åº“é€‰æ‹©ä¿¡æ¯é€šè¿‡ç°æœ‰çš„ `inputs` å­—æ®µä¼ é€’ï¼š

```typescript
{
  "query": "ç”¨æˆ·æ¶ˆæ¯",
  "files": [...],
  "inputs": {
    // ç°æœ‰çš„ inputs å†…å®¹...
    "selected_knowledge_ids": ["kb_001", "kb_002"] // é€‰ä¸­çš„çŸ¥è¯†åº“IDæ•°ç»„
  }
}
```

### åç«¯å¤„ç†å»ºè®®
åç«¯å¯ä»¥æ ¹æ® `selected_knowledge_ids` æ•°ç»„æ¥ç¡®å®šä½¿ç”¨å“ªäº›çŸ¥è¯†åº“è¿›è¡Œæ£€ç´¢å’Œå›ç­”ã€‚

## æ ·å¼è‡ªå®šä¹‰

### ä¸»è¦ CSS ç±»å
- `.knowledge-item`: çŸ¥è¯†åº“é¡¹å®¹å™¨
- `.knowledge-item-color`: é¢œè‰²æ ‡è¯†åœ†ç‚¹
- `.knowledge-item-remove`: åˆ é™¤æŒ‰é’®

### è‡ªå®šä¹‰æ ·å¼ç¤ºä¾‹
```css
/* è‡ªå®šä¹‰çŸ¥è¯†åº“é¡¹æ ·å¼ */
.knowledge-item {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
}

/* è‡ªå®šä¹‰é€‰æ‹©å™¨æ ·å¼ */
.knowledge-selector {
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
  border-radius: 12px;
}
```

## æœ€ä½³å®è·µ

### 1. çŸ¥è¯†åº“æ•°æ®ç»“æ„
- **id**: ä½¿ç”¨æœ‰æ„ä¹‰çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œå»ºè®®æ ¼å¼: `kb_xxx`
- **name**: ä¿æŒç®€æ´ï¼Œå»ºè®®ä¸è¶…è¿‡ 20 ä¸ªå­—ç¬¦
- **description**: æä¾›æœ‰åŠ©äºç”¨æˆ·é€‰æ‹©çš„æè¿°ä¿¡æ¯
- **color**: ä½¿ç”¨åå…­è¿›åˆ¶é¢œè‰²å€¼ï¼Œå»ºè®®ä½¿ç”¨å“ç‰Œè‰²ç³»
- **type**: æ˜ç¡®çŸ¥è¯†åº“ç±»å‹ï¼Œä¾¿äºç”¨æˆ·ç†è§£

### 2. æ€§èƒ½ä¼˜åŒ–
- çŸ¥è¯†åº“åˆ—è¡¨å»ºè®®ä¸è¶…è¿‡ 50 ä¸ªï¼Œè¶…è¿‡æ—¶è€ƒè™‘åˆ†é¡µæˆ–åˆ†ç±»
- æœç´¢åŠŸèƒ½ä½¿ç”¨é˜²æŠ–å¤„ç†ï¼Œé¿å…é¢‘ç¹è¿‡æ»¤
- å¤§é‡çŸ¥è¯†åº“æ—¶è€ƒè™‘è™šæ‹Ÿæ»šåŠ¨

### 3. ç”¨æˆ·ä½“éªŒ
- æä¾›æ¸…æ™°çš„æ“ä½œæç¤º
- åˆç†çš„æœ€å¤§é€‰æ‹©æ•°é‡é™åˆ¶
- é€‚å½“çš„åŠ¨ç”»è¿‡æ¸¡æ•ˆæœ

## æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

1. **é€‰æ‹©å™¨ä¸æ˜¾ç¤º**
   - æ£€æŸ¥ `knowledgeConfig.enabled` æ˜¯å¦ä¸º `true`
   - ç¡®è®¤ `knowledgeList` æ•°ç»„ä¸ä¸ºç©º
   - éªŒè¯è¾“å…¥çš„æ˜¯ `@` ç¬¦å·

2. **å›½é™…åŒ–æ–‡æœ¬ä¸æ˜¾ç¤º**
   - æ£€æŸ¥è¯­è¨€åŒ…æ˜¯å¦åŒ…å« `knowledgeSelector` é…ç½®
   - ç¡®è®¤ i18n åˆå§‹åŒ–æ­£ç¡®

3. **æ ·å¼æ˜¾ç¤ºå¼‚å¸¸**
   - æ£€æŸ¥ Tailwind CSS é…ç½®
   - ç¡®è®¤æ²¡æœ‰æ ·å¼å†²çª

4. **é”®ç›˜å¯¼èˆªä¸å·¥ä½œ**
   - ç¡®è®¤é€‰æ‹©å™¨è·å¾—äº†ç„¦ç‚¹
   - æ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–ç»„ä»¶æ‹¦æˆªé”®ç›˜äº‹ä»¶

## æ›´æ–°æ—¥å¿—

### v1.0.0 (2025-01-15)
- âœ… æ–°å¢çŸ¥è¯†åº“é€‰æ‹©åŠŸèƒ½
- âœ… æ”¯æŒ @ç¬¦å·è§¦å‘é€‰æ‹©å™¨
- âœ… é›†æˆåˆ° Chat ç»„ä»¶
- âœ… å¤šè¯­è¨€æ”¯æŒ (ä¸­/è‹±/è¥¿/æ—¥/è¶Š)
- âœ… å®Œæ•´çš„é”®ç›˜å¯¼èˆªæ”¯æŒ
- âœ… å“åº”å¼è®¾è®¡é€‚é…

## æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·å‚è€ƒï¼š
- è®¾è®¡æ–‡æ¡£: æŸ¥çœ‹å®Œæ•´çš„è®¾è®¡è§„èŒƒ
- ä»£ç ç¤ºä¾‹: `app/components/chat/mock-knowledge-data.ts`
- ç±»å‹å®šä¹‰: `types/app.ts`